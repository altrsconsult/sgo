# docker-compose.dev.yml — override para desenvolvimento de módulos
# Uso: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
#
# Este arquivo configura o chassi-backend para descobrir módulos
# rodando na máquina host via host.docker.internal (Docker Desktop: Windows/Mac).
# O dev roda o módulo localmente (pnpm dev no módulo) e o chassi o detecta automaticamente.

services:
  chassi-backend:
    environment:
      DOCKER_ENV: "true"
      NODE_ENV: development
      # Aceitar qualquer módulo que responda (sem restringir por pasta)
      DEV_MODULES_ACCEPT_ALL: "true"
      MODULES_DEV_DIR: /app/dev_modules
      MODULES_LAB_DEV_DIR: /app/dev_modules_lab
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      # Monta source do backend para hot-reload (com tsx watch)
      - ./chassi/backend/src:/app/src
      # Monta pastas de módulos para descoberta restrita (só esses slugs são registrados)
      - ./modules:/app/dev_modules:ro
      - ./modules-lab:/app/dev_modules_lab:ro
    command: npx tsx watch src/index.ts
